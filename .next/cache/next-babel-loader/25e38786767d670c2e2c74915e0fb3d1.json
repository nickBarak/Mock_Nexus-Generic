{"ast":null,"code":"import { testEmail } from '../../Functions';\nimport { queryDB, insertUser, getUser } from '../../db';\nexport default async function (req, res) {\n  console.log('api hit');\n  let newUser,\n      {\n    name,\n    email,\n    articleID,\n    following\n  } = req.body;\n\n  if (!testEmail(email)) {\n    res.json(1);\n    res.end();\n    return;\n  }\n\n  try {\n    let user = await getUser(email);\n\n    if (user) {\n      if (user.name !== name) {\n        res.json(2);\n        res.end();\n        return;\n      }\n    } else {\n      newUser = true;\n      await insertUser(name, email);\n    }\n\n    await queryDB(`UPDATE users SET following = array_${!following ? 'append' : 'remove'}(following, $1) WHERE email = $2`, [articleID, email]);\n    await queryDB(`UPDATE articles SET followers = array_${!following ? 'append' : 'remove'}(following, $1) WHERE id = $2`, [email, articleID]);\n\n    if (newUser) {\n      res.json(3);\n      res.end();\n      return;\n    }\n\n    res.json(0);\n    res.end();\n  } catch (e) {\n    console.log(e);\n  }\n}","map":{"version":3,"sources":["C:/Users/nicho/Code/Portfolio/mock_nexus/pages/api/follow-article.js"],"names":["testEmail","queryDB","insertUser","getUser","req","res","console","log","newUser","name","email","articleID","following","body","json","end","user","e"],"mappings":"AAAA,SAASA,SAAT,QAA0B,iBAA1B;AACA,SAASC,OAAT,EAAkBC,UAAlB,EAA8BC,OAA9B,QAA6C,UAA7C;AAEA,eAAe,gBAAeC,GAAf,EAAoBC,GAApB,EAAyB;AACpCC,EAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;AACA,MAAIC,OAAJ;AAAA,MACI;AAAEC,IAAAA,IAAF;AAAQC,IAAAA,KAAR;AAAeC,IAAAA,SAAf;AAA0BC,IAAAA;AAA1B,MAAwCR,GAAG,CAACS,IADhD;;AAEA,MAAI,CAACb,SAAS,CAACU,KAAD,CAAd,EAAuB;AAAEL,IAAAA,GAAG,CAACS,IAAJ,CAAS,CAAT;AAAaT,IAAAA,GAAG,CAACU,GAAJ;AAAW;AAAQ;;AACzD,MAAI;AACA,QAAIC,IAAI,GAAG,MAAMb,OAAO,CAACO,KAAD,CAAxB;;AACA,QAAIM,IAAJ,EAAU;AACN,UAAIA,IAAI,CAACP,IAAL,KAAcA,IAAlB,EAAwB;AAAEJ,QAAAA,GAAG,CAACS,IAAJ,CAAS,CAAT;AAAaT,QAAAA,GAAG,CAACU,GAAJ;AAAW;AAAQ;AAC7D,KAFD,MAEO;AACHP,MAAAA,OAAO,GAAG,IAAV;AACA,YAAMN,UAAU,CAACO,IAAD,EAAOC,KAAP,CAAhB;AACH;;AACD,UAAMT,OAAO,CAAE,sCAAqC,CAACW,SAAD,GAAa,QAAb,GAAwB,QAAS,kCAAxE,EAA2G,CAACD,SAAD,EAAYD,KAAZ,CAA3G,CAAb;AACA,UAAMT,OAAO,CAAE,yCAAwC,CAACW,SAAD,GAAa,QAAb,GAAwB,QAAS,+BAA3E,EAA2G,CAACF,KAAD,EAAQC,SAAR,CAA3G,CAAb;;AACA,QAAIH,OAAJ,EAAa;AAAEH,MAAAA,GAAG,CAACS,IAAJ,CAAS,CAAT;AAAaT,MAAAA,GAAG,CAACU,GAAJ;AAAW;AAAQ;;AAC/CV,IAAAA,GAAG,CAACS,IAAJ,CAAS,CAAT;AACAT,IAAAA,GAAG,CAACU,GAAJ;AACH,GAbD,CAaE,OAAOE,CAAP,EAAU;AAAEX,IAAAA,OAAO,CAACC,GAAR,CAAYU,CAAZ;AAAgB;AACjC","sourcesContent":["import { testEmail } from '../../Functions';\r\nimport { queryDB, insertUser, getUser } from '../../db';\r\n\r\nexport default async function(req, res) {\r\n    console.log('api hit');\r\n    let newUser,\r\n        { name, email, articleID, following } = req.body;\r\n    if (!testEmail(email)) { res.json(1); res.end(); return }\r\n    try {\r\n        let user = await getUser(email);\r\n        if (user) {\r\n            if (user.name !== name) { res.json(2); res.end(); return }\r\n        } else {\r\n            newUser = true;\r\n            await insertUser(name, email);\r\n        }\r\n        await queryDB(`UPDATE users SET following = array_${!following ? 'append' : 'remove'}(following, $1) WHERE email = $2`, [articleID, email]);\r\n        await queryDB(`UPDATE articles SET followers = array_${!following ? 'append' : 'remove'}(following, $1) WHERE id = $2`, [email, articleID]);\r\n        if (newUser) { res.json(3); res.end(); return }\r\n        res.json(0);\r\n        res.end();\r\n    } catch (e) { console.log(e) }\r\n}"]},"metadata":{},"sourceType":"module"}