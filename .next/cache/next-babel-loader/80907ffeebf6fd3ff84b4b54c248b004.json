{"ast":null,"code":"import { testEmail } from '../../Functions';\nimport { queryDB, insertUser, getUser } from '../../db';\nexport default async function (req, res) {\n  let newUser,\n      {\n    name,\n    email,\n    articleID,\n    following\n  } = req.body;\n\n  if (!testEmail(email)) {\n    res.json(1);\n    res.end();\n    return;\n  }\n\n  try {\n    let user = await getUser(email);\n\n    if (user) {\n      if (user.name !== name) {\n        res.json(2);\n        res.end();\n        return;\n      }\n    } else {\n      newUser = true;\n      await insertUser(name, email);\n    }\n\n    await queryDB(`UPDATE users SET following = array_${!following ? 'append' : 'remove'}(following, $1) WHERE email = $2`, [articleID, email]);\n    await queryDB(`UPDATE articles SET followers = array_${!following ? 'append' : 'remove'}(followers, $1) WHERE id = $2`, [email, articleID]);\n\n    if (newUser) {\n      res.json(3);\n      res.end();\n      return;\n    }\n\n    res.json(0);\n    res.end();\n  } catch (e) {\n    console.log(e);\n  }\n}","map":null,"metadata":{},"sourceType":"module"}