{"ast":null,"code":"import { queryDB } from '../../db';\nexport default async function (req, res) {\n  let {\n    id,\n    email,\n    article_id\n  } = req.body;\n\n  try {\n    let [articleComments] = await queryDB('SELECT comments FROM articles WHERE id = $1', [article_id]);\n    let [userComments] = await queryDB('SELECT comments FROM users WHERE email = $1', [email]);\n\n    function deleteComment(id, level) {\n      return level.forEach(comment => {\n        if (comment.id === id) {\n          comment.content = comment.name = comment.email = 'deleted';\n        } else deleteComment(id, comment.replies);\n      });\n    }\n\n    deleteComment(id, articleComments.comments);\n    deleteComment(id, userComments.comments);\n    await queryDB('UPDATE articles SET comments = $1 WHERE id = $2', [articleComments.comments, article_id]);\n    await queryDB('UPDATE users SET comments = $1 WHERE email = $2', [userComments.comments, email]);\n    res.json(0);\n    res.end();\n  } catch (e) {\n    console.log(e);\n  }\n}","map":null,"metadata":{},"sourceType":"module"}