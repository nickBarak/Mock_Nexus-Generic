{"ast":null,"code":"import { getUser, insertUser, queryDB } from '../../db';\nimport { testEmail } from '../../Functions';\nexport default async function (req, res) {\n  let newUser,\n      {\n    name,\n    email,\n    articleID,\n    following\n  } = req.body;\n\n  if (!testEmail(email)) {\n    res.json(1);\n    res.end();\n    return;\n  }\n\n  try {\n    let user = await getUser(email);\n\n    if (user) {\n      if (user.name !== name) {\n        res.json(2);\n        res.end();\n        return;\n      }\n    } else {\n      newUser = true;\n      await insertUser(name, email);\n    }\n\n    await queryDB(`UPDATE users SET following = array_${!following ? 'append' : 'remove'}(following, $1) WHERE email = $2`, [articleID, email]);\n    await queryDB(`UPDATE articles SET followers = array_${!following ? 'append' : 'remove'}(following, $1) WHERE id = $2`, [email, articleID]);\n\n    if (newUser) {\n      res.json(3);\n      res.end();\n      return;\n    }\n\n    res.json(0);\n    res.end();\n  } catch (e) {\n    console.log(e);\n  }\n}","map":{"version":3,"sources":["C:/Users/nicho/Code/Portfolio/mock_nexus/pages/api/follow-article.js"],"names":["getUser","insertUser","queryDB","testEmail","req","res","newUser","name","email","articleID","following","body","json","end","user","e","console","log"],"mappings":"AAAA,SAASA,OAAT,EAAkBC,UAAlB,EAA8BC,OAA9B,QAA6C,UAA7C;AACA,SAASC,SAAT,QAA0B,iBAA1B;AAEA,eAAe,gBAAeC,GAAf,EAAoBC,GAApB,EAAyB;AACpC,MAAIC,OAAJ;AAAA,MACI;AAAEC,IAAAA,IAAF;AAAQC,IAAAA,KAAR;AAAeC,IAAAA,SAAf;AAA0BC,IAAAA;AAA1B,MAAwCN,GAAG,CAACO,IADhD;;AAEA,MAAI,CAACR,SAAS,CAACK,KAAD,CAAd,EAAuB;AAAEH,IAAAA,GAAG,CAACO,IAAJ,CAAS,CAAT;AAAaP,IAAAA,GAAG,CAACQ,GAAJ;AAAW;AAAQ;;AACzD,MAAI;AACA,QAAIC,IAAI,GAAG,MAAMd,OAAO,CAACQ,KAAD,CAAxB;;AACA,QAAIM,IAAJ,EAAU;AACN,UAAIA,IAAI,CAACP,IAAL,KAAcA,IAAlB,EAAwB;AAAEF,QAAAA,GAAG,CAACO,IAAJ,CAAS,CAAT;AAAaP,QAAAA,GAAG,CAACQ,GAAJ;AAAW;AAAQ;AAC7D,KAFD,MAEO;AACHP,MAAAA,OAAO,GAAG,IAAV;AACA,YAAML,UAAU,CAACM,IAAD,EAAOC,KAAP,CAAhB;AACH;;AACD,UAAMN,OAAO,CAAE,sCAAqC,CAACQ,SAAD,GAAa,QAAb,GAAwB,QAAS,kCAAxE,EAA2G,CAACD,SAAD,EAAYD,KAAZ,CAA3G,CAAb;AACA,UAAMN,OAAO,CAAE,yCAAwC,CAACQ,SAAD,GAAa,QAAb,GAAwB,QAAS,+BAA3E,EAA2G,CAACF,KAAD,EAAQC,SAAR,CAA3G,CAAb;;AACA,QAAIH,OAAJ,EAAa;AAAED,MAAAA,GAAG,CAACO,IAAJ,CAAS,CAAT;AAAaP,MAAAA,GAAG,CAACQ,GAAJ;AAAW;AAAQ;;AAC/CR,IAAAA,GAAG,CAACO,IAAJ,CAAS,CAAT;AACAP,IAAAA,GAAG,CAACQ,GAAJ;AACH,GAbD,CAaE,OAAOE,CAAP,EAAU;AAAEC,IAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AAAgB;AACjC","sourcesContent":["import { getUser, insertUser, queryDB } from '../../db';\r\nimport { testEmail } from '../../Functions';\r\n\r\nexport default async function(req, res) {\r\n    let newUser,\r\n        { name, email, articleID, following } = req.body;\r\n    if (!testEmail(email)) { res.json(1); res.end(); return }\r\n    try {\r\n        let user = await getUser(email);\r\n        if (user) {\r\n            if (user.name !== name) { res.json(2); res.end(); return }\r\n        } else {\r\n            newUser = true;\r\n            await insertUser(name, email);\r\n        }\r\n        await queryDB(`UPDATE users SET following = array_${!following ? 'append' : 'remove'}(following, $1) WHERE email = $2`, [articleID, email]);\r\n        await queryDB(`UPDATE articles SET followers = array_${!following ? 'append' : 'remove'}(following, $1) WHERE id = $2`, [email, articleID]);\r\n        if (newUser) { res.json(3); res.end(); return }\r\n        res.json(0);\r\n        res.end();\r\n    } catch (e) { console.log(e) }\r\n}"]},"metadata":{},"sourceType":"module"}